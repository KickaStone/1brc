# 输入输出流

![](./img/流继承关系.png)

## 流

什么是流？

流是一种抽象，它可以让使用者接受或发送不定数量的字节，如水流一样。读写文件，通过连接收发数据都可以使用流的方式，这是通用术语，而没有具体实现。

## fstream
c++中fstream实现包括了两条继承路线，其一是stream流路线

```
ios_base <- ios <- (istream+ostream) <- iostream <- fstream
```

其中fstream中有一个buffer叫作filebuf, filebuf的继承路线是
```
basic_streambuf<charT, traits> <- basic_filebuf<charT, traits> <- file_buf
```

流类提供高层的一些接口，如格式化输入输出、运算符<<，状态管理等，它本身不会直接读写关联的文件，而是依赖`filebuf`进行IO操作，二者写作完成文件输入输出操作。

## ifstream

ifstream 构造器 constructor
第一种不绑定文件，后续用open()绑定，第二种绑定filename，读取模式默认设置为ios_base::in。
```c++
default (1)	ifstream();
initialization (2)	
explicit ifstream (const char* filename, ios_base::openmode mode = ios_base::in);
explicit ifstream (const string& filename, ios_base::openmode mode = ios_base::in);
```

`ifstream::open`

```c++
void open (const   char* filename,  ios_base::openmode mode = ios_base::in);
void open (const string& filename,  ios_base::openmode mode = ios_base::in);
```

open即把文件名与ifstream绑定

`ifstream::is_open()` 文件流与文件绑定，返回true，否则返回false。
`ifstream::close()` 关闭文件流
`ifstream::rdbuf()` 返回一个filebuf对象指针

赋值运算只能用右值。

读取流程：
ifstream包含一个std::file_buf buffer;
`std::getline(file, line)` 会先检查流状态是否出错；然后调用file.rdbuf()->sgetc()从底层缓冲区读取数据。
如果缓冲区空，触发underflow() 从操作系统读取下一批字节。按行解析，直到遇到\n或文件末尾。
将内容存入std::string line.

